!function(){angular.module("botanika",["ionic","botanika.research","botanika.config","pouchdb","ngCordova"])}(),function(){function e(e,r){function n(){return r.when(i.query("research",{include_docs:!0})).then(function(e){return e.rows})}function t(e){return r.when(i.get(e))}function o(e){return t(e).then(function(e){return i.remove(e)})}function a(e){return e._id?r.when(i.put(e)):(e.type="research",r.when(i.post(e)))}var c={getAll:n,load:t,remove:o,save:a},i=e.getDatabase(),s=e.createDesignDoc("research",function(e){"research"===e.type&&emit(e._id)});return i.put(s),c}angular.module("botanika").service("Research",e),e.$inject=["Database","$q","pouchDB"]}(),function(){function e(e,r){function n(e){return r.when(i.query("record_by_research",{startkey:e,endkey:e,descending:!0,include_docs:!0})).then(function(e){return e.rows})}function t(e,n){return"undefined"==typeof n&&(n=!1),r.when(i.get(e,{attachments:n})).then(function(e){return n&&e._attachments&&(e.photo=e._attachments.photo.data),e})}function o(e){return t(e).then(function(e){return i.remove(e)})}function a(e){return e._id?r.reject("Record cannot be updated"):e.researchId?(e.photo&&(e._attachments={photo:{content_type:"image/png",data:e.photo}}),e.type="record",e.createdAt=new Date,r.when(i.post(e))):r.reject("Research id is required")}var c={allByResearch:n,save:a,load:t,remove:o},i=e.getDatabase(),s=e.createDesignDoc("record",function(e){"record"===e.type&&emit(e._id)});i.put(s);var u=e.createDesignDoc("record_by_research",function(e){"record"===e.type&&emit(e.researchId,e.createdAt)});return i.put(u),c}angular.module("botanika").service("Record",e),e.$inject=["Database","$q","pouchDB"]}(),function(){function e(e,r){function n(){return a}function t(e,r){var n={_id:"_design/"+e,views:{}};return n.views[e]={map:r.toString()},n}var o={getDatabase:n,createDesignDoc:t},a=r("botanika",{adapter:"websql"});return o}angular.module("botanika").service("Database",e),e.$inject=["$q","pouchDB"]}(),function(){function e(){return function(e){return"undefined"==typeof e?"":e.length>150?e.substring(0,150)+" ... (ver detalhes)":0==e.length?"Nenhuma descrição":e}}angular.module("botanika").filter("seeMore",e)}(),function(){function e(e){return function(r,n){return"undefined"==typeof r?"":r.lat||r.lon?("undefined"==typeof n&&(n=6),e("number")(r.lat,n)+", "+e("number")(r.lon,n)):""}}angular.module("botanika").filter("location",e),e.$inject=["$filter"]}(),function(){angular.module("botanika.research",[])}(),function(){function e(e,r,n){function t(){a.loading=!0,e.getAll().then(function(e){a.loading=!1,a.researchs=e})}function o(r){n.show({template:"Removendo projeto ..."}),e.remove(r)["finally"](function(){t(),n.hide()})}var a=this;r.$on("$ionicView.beforeEnter",function(){a.researchs=[],t()}),a.researchs=[],t(),a.remove=o}angular.module("botanika.research").controller("ResearchListController",e),e.$inject=["Research","$scope","$ionicLoading"]}(),function(){function e(e,r,n){function t(e){n.load(e).then(function(e){u.research=e})}function o(){u.research={metrics:[],name:"",description:""}}function a(){u.metric={name:"",type:0}}function c(){var e=angular.copy(u.metric);u.research.metrics.push(e),a()}function i(e){u.research.metrics.splice(e,1)}function s(){var e=angular.copy(u.research);n.save(e).then(function(){r.goBack()})}var u=this,l=e.params.id;u.isEditing=!!l;var d=["Numérico"];u.types=d,u.addMetric=c,u.removeMetric=i,u.saveResearch=s,u.isEditing?t(l):o(),a()}angular.module("botanika.research").controller("ResearchController",e),e.$inject=["$state","$ionicHistory","Research"]}(),function(){angular.module("botanika.record",[])}(),function(){function e(e,r,n,t,o){function a(){i.loading=!0,e.allByResearch(s).then(function(e){i.loading=!1,i.records=e})}function c(r){e.remove(r).then(function(){i.records=[],a()})}var i=this,s=n.params.researchId;t.$on("$ionicView.afterEnter",function(){r.load(s).then(function(e){o.title(e.name)})}),t.$on("$ionicView.beforeEnter",function(){i.records=[],a()}),i.records=[],a(),i.remove=c}angular.module("botanika.research").controller("RecordListController",e),e.$inject=["Record","Research","$state","$scope","$ionicNavBarDelegate"]}(),function(){function e(e,r,n,t,o){function a(e){n.load(e,!0).then(function(e){f.record=e})}function c(){f.record={measures:[],observation:"",photo:null,location:{lat:null,lon:null}},f.locationStatus=null}function i(){t.getCurrentPosition({enableHighAccuracy:!0}).then(function(e){f.record.location.lat=e.coords.latitude,f.record.location.lon=e.coords.longitude,f.locationStatus="success"},function(){f.locationStatus="error"})}function s(){var e=angular.copy(f.record);e.researchId=m,n.save(e).then(function(){r.goBack()})["catch"](function(e){console.log(e)})}function u(){return{quality:50,destinationType:Camera.DestinationType.DATA_URL,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1}}function l(){var e=u();e.sourceType=Camera.PictureSourceType.CAMERA,h(e)}function d(){var e=u();e.sourceType=Camera.PictureSourceType.PHOTOLIBRARY,h(e)}function h(e){o.getPicture(e).then(function(e){f.record.photo=e},function(){})}var f=this,m=e.params.researchId,p=e.params.id;f.isShowing=!!p,f.cameraAvailable=!!navigator.camera,f.saveRecord=s,f.selectPicture=d,f.takePicture=l,f.isShowing?a(p):(c(),i())}angular.module("botanika.research").controller("RecordEditController",e),e.$inject=["$state","$ionicHistory","Record","$cordovaGeolocation","$cordovaCamera"]}(),function(){function e(e,r){e.state("research",{url:"/research",templateUrl:"src/research/research.list.html",controller:"ResearchListController as vm"}).state("research.new",{url:"/new",parent:"research",views:{"@":{templateUrl:"src/research/research.edit.html",controller:"ResearchController as vm"}}}).state("research.edit",{url:"/:id",parent:"research",views:{"@":{templateUrl:"src/research/research.edit.html",controller:"ResearchController as vm"}}}).state("research.records",{url:"/:researchId/records",parent:"research",views:{"@":{templateUrl:"src/record/record.list.html",controller:"RecordListController as vm"}}}).state("research.records.new",{url:"/new",parent:"research.records",views:{"@":{templateUrl:"src/record/record.edit.html",controller:"RecordEditController as vm"}}}).state("research.records.show",{url:"/:id",parent:"research.records",views:{"@":{templateUrl:"src/record/record.edit.html",controller:"RecordEditController as vm"}}}),r.otherwise("/research")}function r(e,r,n){e.ready(function(){ionic.Platform.isIOS()&&(r.overlaysWebView(!0),r.style(1),n.disableScroll(!0))})}angular.module("botanika.config",[]).config(e).run(r),e.$inject=["$stateProvider","$urlRouterProvider"],r.$inject=["$ionicPlatform","$cordovaStatusbar","$cordovaKeyboard"]}();